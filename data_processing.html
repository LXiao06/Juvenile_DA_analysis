<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2025-07-15" />

<title>Data Processing</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Juvenile DA Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="diagram/interactive-flowchart.html">Analytics Architecture</a>
</li>
<li>
  <a href="data_processing.html">Data Processing</a>
</li>
<li>
  <a href="individual_analysis.html">Individual Analysis</a>
</li>
<li>
  <a href="population_analysis.html">Population Analysis</a>
</li>
<li>
  <a href="reference.html">Reference</a>
</li>
<li>
  <a href="https://github.com/LXiao06/Juvenile_DA_analysis">GitHub</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Data Processing</h1>
<h4 class="date">2025-07-15</h4>

</div>


<p><br />
</p>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p><strong>This tutorial demonstrates the data processing pipeline for
analyzing longitudinal fiber photometry dopamine data recorded from
vocal basal ganglia in juvenile birds. The analysis uses the VNS and
ASAP packages to process both fiber photometry signals and corresponding
song recordings.</strong><br />
<br />
</p>
<blockquote>
<h3 id="download-source-data">Download Source Data</h3>
<p>To begin, download the source data from the following repository.</p>
<ul>
<li><strong>Repository:</strong> <a
href="https://doi.org/10.7924/r4s186852">Duke University Library
Research Data Repository</a></li>
<li><strong>Dataset:</strong> The juvenile bird datasets are located
within the <code>JuvDA</code> directory.</li>
<li><strong>Citation:</strong> These data are provided with the
publication at <a
href="https://doi.org/10.1038/s41586-025-08694-9">doi.org/10.1038/s41586-025-08694-9</a>.</li>
</ul>
<h3 id="install-required-pacakges">Install Required Pacakges</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">require</span>(remotes)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;LXiao06/ASAP&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;LXiao06/VocalNeuroSync&quot;</span>)</span></code></pre></div>
</blockquote>
</div>
<div id="load-packages" class="section level2">
<h2>Load Packages</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ASAP&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;VocalNeuroSync&quot;</span>)</span></code></pre></div>
<p><br />
</p>
</div>
<div id="data-organization" class="section level2">
<h2>Data Organization</h2>
<p>The first step involves organizing raw data files from individual
animals into a structured format suitable for analysis.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">organize_bird_files</span>(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="at">root_dir =</span> <span class="st">&quot;dir/path/to/raw/data/of/individual/animals&quot;</span>,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="at">bird_id =</span> <span class="st">&quot;B633&quot;</span>,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="at">dob =</span> <span class="st">&quot;2/5/2022&quot;</span>,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">&quot;dir/path/to/reorganized/data&quot;</span>,</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="at">file_prefixes =</span> <span class="fu">c</span>(<span class="st">&quot;combo_test&quot;</span>, <span class="st">&quot;test_audio&quot;</span>),</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  <span class="at">file_extensions =</span> <span class="fu">c</span>(<span class="st">&quot;csv&quot;</span>, <span class="st">&quot;wav&quot;</span>),</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>)</span></code></pre></div>
<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>root_dir</code></td>
<td align="left">Path to raw data directory</td>
</tr>
<tr class="even">
<td align="left"><code>bird_id</code></td>
<td align="left">Unique identifier for the individual bird (B633)</td>
</tr>
<tr class="odd">
<td align="left"><code>dob</code></td>
<td align="left">Date of birth (2/5/2022)</td>
</tr>
<tr class="even">
<td align="left"><code>output_dir</code></td>
<td align="left">Destination for reorganized data</td>
</tr>
<tr class="odd">
<td align="left"><code>file_prefixes</code></td>
<td align="left">Expected file name prefixes for photometry and audio
data</td>
</tr>
<tr class="even">
<td align="left"><code>file_extensions</code></td>
<td align="left">File types to process (CSV for photometry, WAV for
audio)</td>
</tr>
</tbody>
</table>
<p><br />
</p>
</div>
<div id="npm-object-creation" class="section level2">
<h2>NPM Object Creation</h2>
<p>Create the main analysis object that will contain both photometry and
audio data with associated metadata.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Create npm object</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>npm <span class="ot">&lt;-</span> <span class="fu">create_npm_object</span>(</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="at">base_path =</span> <span class="st">&quot;dir/path/to/reorganized/data&quot;</span>,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="at">subfolders_to_include =</span> <span class="cn">NULL</span>,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">paste0</span>(<span class="fu">c</span>(<span class="dv">72</span><span class="sc">:</span><span class="dv">83</span>, <span class="dv">85</span><span class="sc">:</span><span class="dv">91</span>), <span class="st">&quot;dph&quot;</span>),  <span class="co"># Days post-hatch</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="at">imageArea =</span> <span class="st">&quot;Area X&quot;</span>,</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  <span class="at">sensor =</span> <span class="st">&quot;GRAB-DA2m&quot;</span>,</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  <span class="at">fps =</span> <span class="dv">30</span>,</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  <span class="at">numChannel =</span> <span class="dv">2</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>labels</code></td>
<td align="left">Time points from 72-83 and 85-91 days post-hatch
(dph)</td>
</tr>
<tr class="even">
<td align="left"><code>imageArea</code></td>
<td align="left">Recording location (Area X - the vocal Basal
ganglia)</td>
</tr>
<tr class="odd">
<td align="left"><code>sensor</code></td>
<td align="left">GRAB-DA2m (genetically encoded dopamine sensor)</td>
</tr>
<tr class="even">
<td align="left"><code>fps</code></td>
<td align="left">Sampling rate at 30 frames per second</td>
</tr>
<tr class="odd">
<td align="left"><code>numChannel</code></td>
<td align="left">2-channel recording setup</td>
</tr>
</tbody>
</table>
<p><br />
</p>
</div>
<div id="aduio-data-processing" class="section level2">
<h2>Aduio Data Processing</h2>
<p>Process song recordings using ASAP (Automated Song Analysis Pipeline)
to identify epochs, e.g. song bouts and motifs.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>npm <span class="ot">&lt;-</span> npm <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="fu">compute_wav_durations</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="fu">create_audio_clip</span>(<span class="at">indices =</span> <span class="dv">50</span>, <span class="at">start_time =</span><span class="dv">70</span>,</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>                    <span class="at">end_time =</span> <span class="dv">73</span>, <span class="at">clip_names =</span> <span class="st">&quot;m1&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="fu">create_template</span>(<span class="at">template_name =</span> <span class="st">&quot;bc&quot;</span>, <span class="at">clip_name =</span> <span class="st">&quot;m1&quot;</span>,</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>                  <span class="at">start_time =</span> <span class="fl">0.63</span>, <span class="at">end_time =</span>  <span class="fl">0.82</span>,</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>                  <span class="at">freq_min =</span> <span class="fl">0.5</span>, <span class="at">freq_max =</span> <span class="dv">8</span>, <span class="at">write_template =</span> T) <span class="sc">|&gt;</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  <span class="fu">detect_template</span>(<span class="at">template_name =</span> <span class="st">&quot;bc&quot;</span>, <span class="at">day =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>                  <span class="at">indices =</span> <span class="cn">NULL</span>, <span class="at">proximity_window =</span> <span class="dv">1</span>,</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>                  <span class="at">threshold =</span> <span class="cn">NULL</span>, <span class="at">save_plot =</span> F) <span class="sc">|&gt;</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  <span class="fu">find_motif</span>(<span class="at">template_name =</span> <span class="st">&quot;bc&quot;</span>, <span class="at">pre_time =</span> <span class="fl">0.4</span>, <span class="at">lag_time =</span> <span class="fl">0.5</span>)<span class="sc">|&gt;</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>  <span class="fu">find_bout</span>(<span class="at">min_duration =</span> <span class="fl">0.5</span>, <span class="at">summary =</span> <span class="cn">TRUE</span>, <span class="at">gap_duration =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>  <span class="fu">plot_heatmap</span>(<span class="at">segment_type =</span> <span class="st">&quot;bouts&quot;</span>, <span class="at">balanced =</span>T)</span></code></pre></div>
<p><strong>Processing Steps</strong></p>
<p>The analysis is performed through a series of dedicated functions.
The table below outlines each step and its purpose.</p>
<table>
<colgroup>
<col width="31%" />
<col width="68%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>compute_wav_durations()</code></td>
<td align="left">Calculates the total duration of all audio files.</td>
</tr>
<tr class="even">
<td align="left"><code>create_audio_clip()</code></td>
<td align="left">Extracts specific time segments for manual template
selection.</td>
</tr>
<tr class="odd">
<td align="left"><code>create_template()</code></td>
<td align="left">Defines a spectral template for song syllable
detection.</td>
</tr>
<tr class="even">
<td align="left"><code>detect_template()</code></td>
<td align="left">Finds all occurrences of the template across
recordings.</td>
</tr>
<tr class="odd">
<td align="left"><code>find_motif()</code></td>
<td align="left">Identifies repeated sequences of syllables (vocal
motifs).</td>
</tr>
<tr class="even">
<td align="left"><code>find_bout()</code></td>
<td align="left">Groups individual vocal elements into singing
bouts.</td>
</tr>
<tr class="odd">
<td align="left"><code>plot_heatmap()</code></td>
<td align="left">Visualizes bout structure and patterns across
development.</td>
</tr>
</tbody>
</table>
<p><br />
</p>
</div>
<div id="photometry-data-processing" class="section level2">
<h2>Photometry Data Processing</h2>
<p>Process fiber photometry data using VNS (VocalNeuroSync) pipeline to
detect dopamine transients/peaks.</p>
<div id="data-preprocessing" class="section level3">
<h3>Data Preprocessing</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>npm <span class="ot">&lt;-</span> npm <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">read_photometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="fu">qc_photometry</span>() <span class="sc">|&gt;</span>      <span class="co"># This step is optional</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="fu">process_photometry</span>(<span class="at">by_epoch =</span> <span class="cn">TRUE</span>, <span class="at">epoch_window_quantile =</span> <span class="fl">0.9</span>)</span></code></pre></div>
</div>
<div id="synchronization" class="section level3">
<h3>Synchronization</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>npm <span class="ot">&lt;-</span> npm <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a> <span class="fu">sync_epoch</span>(<span class="at">scale =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">find_transients</span>(<span class="at">method =</span> <span class="st">&quot;epoch&quot;</span>, <span class="at">lag =</span> <span class="dv">100</span>, <span class="at">threshold =</span> <span class="dv">2</span>, <span class="at">influence =</span> <span class="fl">0.15</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="fu">sync_epoch</span>(<span class="at">data_type =</span> <span class="st">&quot;transient&quot;</span>, <span class="at">scale =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="fu">filter_peaks</span>() <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="fu">sync_epoch</span>(<span class="at">by_peak_value =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><strong>Processing Steps</strong></p>
<table>
<colgroup>
<col width="31%" />
<col width="68%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>read_photometry()</code></td>
<td align="left">Import raw photometry data.</td>
</tr>
<tr class="even">
<td align="left"><code>qc_photometry()</code></td>
<td align="left">Perform optional quality control checks.</td>
</tr>
<tr class="odd">
<td align="left"><code>process_photometry()</code>.</td>
<td align="left">Apply baseline correction and process the signal.</td>
</tr>
<tr class="even">
<td align="left"><code>sync_epoch()</code></td>
<td align="left">Synchronize the <strong>continuous photometry
signal</strong> across epochs.</td>
</tr>
<tr class="odd">
<td align="left"><code>find_transients()</code></td>
<td align="left">Detect dopamine transients using a peak detection
algorithm.</td>
</tr>
<tr class="even">
<td align="left"><code>sync_epoch()</code></td>
<td align="left">Synchronize the detected <strong>transients</strong>
for temporal shift analysis.</td>
</tr>
<tr class="odd">
<td align="left"><code>filter_peaks()</code></td>
<td align="left">Measure the peak amplitude of dopamine signals within
epochs.</td>
</tr>
<tr class="even">
<td align="left"><code>sync_epoch()</code></td>
<td align="left">Synchronize the measured <strong>peak
amplitudes</strong> for amplitude shift analysis.</td>
</tr>
</tbody>
</table>
<p><br />
</p>
</div>
</div>
<div id="data-export" class="section level2">
<h2>Data Export</h2>
<p>Save the processed npm object for subsequent analysis.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">saveRDS</span>(npm, <span class="st">&quot;./data/npm_B633.rds&quot;</span>)</span></code></pre></div>
<p><br />
</p>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<p>This processing pipeline successfully:</p>
<ol style="list-style-type: decimal">
<li><strong>Organized</strong> raw data files into a structured
format</li>
<li><strong>Created</strong> an npm object containing both photometry
and audio data</li>
<li><strong>Processed</strong> song recordings to identify vocal motifs
and bouts</li>
<li><strong>Analyzed</strong> photometry data to detect dopamine
transients and peak values</li>
<li><strong>Synchronized</strong> neural signals with vocal
behavior</li>
<li><strong>Saved</strong> the processed data for downstream
analysis<br />
<br />
</li>
</ol>
</div>
<div id="session-info" class="section level2">
<h2>Session Info</h2>
<pre><code>## R version 4.4.1 (2024-06-14)
## Platform: x86_64-pc-linux-gnu
## Running under: Ubuntu 24.04.2 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 
## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0
## 
## locale:
##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       
##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   
##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          
## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   
## 
## time zone: UTC
## tzcode source: system (glibc)
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## loaded via a namespace (and not attached):
##  [1] digest_0.6.37     R6_2.6.1          fastmap_1.2.0     xfun_0.52        
##  [5] cachem_1.1.0      knitr_1.50        htmltools_0.5.8.1 rmarkdown_2.29   
##  [9] lifecycle_1.0.4   cli_3.6.5         sass_0.4.10       jquerylib_0.1.4  
## [13] compiler_4.4.1    tools_4.4.1       evaluate_1.0.4    bslib_0.9.0      
## [17] yaml_2.3.10       rlang_1.1.6       jsonlite_2.0.0</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
